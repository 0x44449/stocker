# 작업: 유사 뉴스 검색 API

## 배경

뉴스 임베딩 파이프라인이 완성되어 `news_embedding` 테이블에 벡터가 저장된다.
이 벡터를 활용하여 유사한 뉴스를 검색하는 API가 필요하다.

**현재 상태:**
- `news_embedding` 테이블에 KURE-v1 (1024차원) 벡터 저장
- pgvector의 `<=>` (코사인 거리) 연산자 사용 가능
- IVFFlat 인덱스 생성됨

## 목표

검색 쿼리를 입력하면 유사한 뉴스를 반환하는 테스트용 API

## 범위

**할 것:**
- 검색 쿼리 임베딩 생성
- pgvector 유사도 검색
- 상위 N개 뉴스 반환

**안 할 것:**
- 날짜 필터
- 거리 임계값 필터
- 멀티 임베딩

## 엔드포인트

```
GET /search?q=삼성전자 반도체&limit=10
```

### 응답

```json
{
  "results": [
    {
      "news_id": 123,
      "title": "삼성전자, 반도체 투자 확대",
      "distance": 0.15
    },
    ...
  ]
}
```

## 검색 흐름

1. 쿼리 텍스트를 KURE-v1로 임베딩
2. `news_embedding` 테이블에서 코사인 거리 기준 검색
3. `news_raw`와 조인하여 제목 가져오기
4. 상위 N개 반환

## SQL 예시

```sql
SELECT e.news_id, n.title, e.embedding <=> :query_vector AS distance
FROM news_embedding e
JOIN news_raw n ON e.news_id = n.id
ORDER BY distance
LIMIT :limit
```

## 파일 수정

```
analyzer/
  ├─ main.py          ← GET /search 엔드포인트 추가
  └─ embedding.py     ← 모델 재사용 (이미 _get_model() 있음)
```

## 완료 조건

- `GET /search?q=검색어&limit=10` 호출 시 유사 뉴스 목록 반환
- distance 오름차순 정렬 (낮을수록 유사)
