# 헤드라인 뉴스 목록 생성 API (탐색용)

## 목표

특정 날짜의 뉴스에서 기업명 언급 횟수를 카운트하고, 임계값 이상인 종목을 "헤드라인 종목"으로 선정하여 관련 기사와 함께 반환하는 API를 만든다.

이 API는 탐색/검증용이다. 파라미터를 조정하면서 결과를 확인하고, 만족스러우면 이 로직을 나중에 스케줄러로 옮겨 배치 생성하게 된다.

## 배경

종목/기업 히스토리 피드의 "헤드라인 뉴스"를 선정해야 한다.
접근 방식: 일정 기간 내 기업명 언급 횟수가 많은 종목 = 중요 종목 = 헤드라인.
이번 작업은 이 가설을 실제 데이터로 검증하는 첫 단계다.

## 관련 테이블

```
news_raw
  - id, published_at, title, ...

news_company_extraction
  - id, news_id (UNIQUE, FK → news_raw), status, processed_at

news_company_extraction_result
  - id, extraction_id (FK → news_company_extraction), company_name
```

흐름: news_raw → news_company_extraction (1:1) → news_company_extraction_result (1:N)

## 관련 코드 위치

- 엔티티: `com.hanzi.stocker.entities.NewsCompanyExtraction(Result)Entity`
- 리포지토리: `com.hanzi.stocker.repositories.NewsCompanyExtraction(Result)Repository`
- API 패키지: `com.hanzi.stocker.api`

## 할 것

1. **API 엔드포인트**
   - `GET /api/news/headline?date=2026-02-05&threshold=5`
   - `date`: LocalDate (특정일). 필수.
   - `threshold`: 임계값 (이 횟수 이상 언급된 종목만 선정). 선택, 기본값 사용.
     - 기본값은 적당한 값으로 하드코딩 (정하기 어려우면 5로 시작)

2. **로직**
   - news_raw.published_at이 해당 date인 뉴스 대상
   - news_company_extraction.status = 'COMPLETED' 인 것만
   - company_name으로 GROUP BY COUNT
   - count >= threshold 인 종목 선정
   - 선정된 종목별 관련 기사 목록 조회

3. **응답 형태**
   ```json
   {
     "date": "2026-02-05",
     "threshold": 5,
     "totalNewsCount": 150,
     "headlines": [
       {
         "companyName": "삼성전자",
         "count": 23,
         "articles": [
           { "newsId": 1234, "title": "삼성전자 ...", "publishedAt": "2026-02-05T09:00:00" },
           ...
         ]
       },
       ...
     ]
   }
   ```
   - headlines는 count 내림차순 정렬
   - articles는 해당 종목이 추출된 기사 전체 (페이징 없음)

## 안 할 것

- 임베딩 클러스터링 (다음 단계)
- 헤드라인 자동 생성 (기사 제목 선택 등)
- 스케줄러 / 배치 생성
- 종목코드 매핑 (기업명 그대로)
- 결과 DB 저장 (매번 실시간 계산)
- 페이징

## 열린 질문

- 없음 (결과를 보고 다음 단계 결정)
