# Analyzer 구조 정리 - 도메인별 패키지 분리 + 리네이밍

## 배경

- 현재 main.py에 모든 엔드포인트와 스케줄러가 혼재
- 회사 추출, 임베딩, 검색 기능이 분리되지 않음
- 프로젝트명 "analyzer"가 너무 일반적

## 목표

1. 도메인별 패키지로 구조 정리
2. 프로젝트명을 news-analyzer로 변경
3. 엔드포인트 경로 정리

## 프로젝트명 변경

- 폴더: `apps/analyzer` → `apps/news-analyzer`
- pyproject.toml, docker-compose.yml 등 설정 파일 수정
- 모든 import 문 수정 (상대 import 사용)

## 엔드포인트 변경

현재 → 변경:
```
/health                  → /health (유지)
/pending-news            → /extraction/pending
/extract                 → /extraction/run
/batch/start             → /extraction/job/start
/batch/status            → /extraction/job/status
/embedding/start         → /embedding/job/start
/embedding/status        → /embedding/job/status
/search                  → /search (유지)
```

## 목표 구조

```
apps/news-analyzer/
├── pyproject.toml
├── config.py               # 공통 설정
├── database.py             # 공통 DB 연결
├── models.py               # 공통 모델
├── main.py                 # FastAPI 앱 + 스케줄러 + 라우터 등록
├── extraction/
│   ├── __init__.py
│   ├── router.py           # /extraction/* 엔드포인트
│   ├── service.py          # 회사 추출 로직 (LLM 호출)
│   └── job.py              # 배치 처리
├── embedding/
│   ├── __init__.py
│   ├── router.py           # /embedding/* 엔드포인트
│   ├── service.py          # 임베딩 생성 로직
│   └── job.py              # 배치 처리
├── search/
│   ├── __init__.py
│   └── router.py           # /search 엔드포인트
└── tests/
    └── __init__.py
```

## 할 것

### 1. 프로젝트 리네이밍
- apps/analyzer → apps/news-analyzer 폴더명 변경
- pyproject.toml 프로젝트명 수정
- docker-compose.yml 서비스명, 빌드 컨텍스트 수정
- Dockerfile 경로 수정

### 2. extraction 패키지 생성
- router.py: /extraction/pending, /extraction/run, /extraction/job/* 엔드포인트
- service.py: extract_companies() 로직 (기존 llm.py 내용 포함)
- job.py: 배치 처리 (기존 batch.py)

### 3. embedding 패키지 생성
- router.py: /embedding/job/* 엔드포인트
- service.py: 임베딩 생성 로직
- job.py: 배치 처리

### 4. search 패키지 생성
- router.py: /search 엔드포인트

### 5. main.py 정리
- FastAPI 앱 생성
- 스케줄러 설정
- 라우터 등록만 담당

### 6. 기존 파일 정리
- analyzer/ 폴더 삭제 (플랫 구조로 변경)
- llm.py 삭제 (extraction/service.py로 이동)
- batch.py 삭제 (extraction/job.py로 이동)
- embedding.py 삭제 (embedding/ 패키지로 분리)

### 7. import 수정
- 상대 import 사용 (예: `from .config import ...`)

## 안 할 것

- 기능 변경
- 새 엔드포인트 추가
- 테스트 코드 작성
