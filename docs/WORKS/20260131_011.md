# LLM 회사명 추출 응답 포맷 개선

## 배경

- 현재 프롬프트로 LLM 응답이 "companies: JTBC" 형태로 나옴
- 기대값은 "JTBC" 또는 "삼성전자, SK하이닉스" 형태 (prefix 없이 회사명만, 쉼표 구분)

## 목표

- 프롬프트 개선하여 응답 포맷이 "회사명" 또는 "회사명1, 회사명2" 형태로 오도록 함
- 회사가 없는 경우 "없음" 출력
- 후처리 로직 추가

## 현재 응답 예시 (문제)

```
응답: companies: JTBC
응답: 회사 이름: 삼성전자, SK하이닉스
```

## 기대 응답 예시

```
응답: JTBC
응답: 삼성전자, SK하이닉스
응답: 없음
```

## 관련 파일

```
apps/news-analyzer/extraction/service.py
```

## 할 것

### 1. 프롬프트 개선
- "입력:", "출력:" 형식으로 명확히 구분
- 회사가 없는 경우 예시 추가 (출력: 없음)

변경 예시:
```python
PROMPT_TEMPLATE = """아래 텍스트에서 회사/기업 이름만 추출해서 쉼표로 구분해 나열해.
회사가 없으면 "없음"이라고 답해.
다른 설명 없이 결과만 출력해.

예시1)
입력: 삼성전자가 반도체 투자를 발표했고 SK하이닉스도 동참했다.
출력: 삼성전자, SK하이닉스

예시2)
입력: 넷플릭스에서 새 드라마가 공개됐고 교보문고 베스트셀러에 올랐다.
출력: 넷플릭스, 교보문고

예시3)
입력: 오늘 날씨가 좋다.
출력: 없음

입력: {text}
출력:"""
```

### 2. 후처리 추가
- 응답이 "없음"이면 빈 리스트 반환

```python
if not raw or raw == "없음":
    return []
```

### 3. 로컬 테스트

테스트 목적: **응답 포맷 검증** (prefix 없이 쉼표로만 구분된 형태인지)

```bash
# 1. 로컬 서버 구동
cd apps/news-analyzer
uvicorn main:app --port 8000

# 2. pending 목록에서 5개 조회
curl http://localhost:8000/extraction/pending?limit=5

# 3. 각 news_id로 extraction/run 호출 (5개 반복)
curl -X POST http://localhost:8000/extraction/run \
  -H "Content-Type: application/json" \
  -d '{"news_id": <id>}'

# 4. 서버 로그에서 "LLM raw response:" 확인
```

### 4. 검증 기준

서버 로그에서 `LLM raw response:` 뒤의 값이:
- "companies:", "회사 이름:", "출력:" 같은 prefix가 없어야 함
- "삼성전자, SK하이닉스" 또는 "없음" 형태여야 함

## 안 할 것

- 배치 로직 수정
- 다른 파일 수정
- 회사명 정확도 검증 (목적 아님)
