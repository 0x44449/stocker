# Project Memory

프로젝트의 방향성과 설계 결정을 기록합니다.
Architect가 설계 시 참고하는 문서입니다.

---

## 프로젝트 개요

**stocker** - 한국 주식 시장 뉴스 분석 파이프라인

### 핵심 비전

> 인스타/페북처럼 사람들 간의 피드가 아니라,
> **종목/기업의 히스토리 피드**를 볼 수 있는 서비스

### 원하는 기능

| # | 기능 | 핵심 |
|---|------|------|
| 1 | 관심종목 뉴스 모아보기 | 뉴스 ↔ 종목 연결 필요 |
| 2 | 주식 상황 설명 | 브리핑/요약 느낌 |
| 3 | 종목별 히스토리 타임라인 | 뉴스 + 가격 + 이벤트 시간순 |

### 구현 우선순위

```
1번 (관심종목 뉴스) → 가장 기초, 먼저
     ↓
3번 (종목 히스토리) → 1번 되면 자연스럽게 가능
     ↓
2번 (상황 설명) → 제일 어려움, 나중에
```

## 핵심 원칙

### 비용 최소화
- 외부 API 비용 없이 로컬에서 처리
- LLM: 로컬 Ollama 사용 (qwen2.5:7b)
- 임베딩: 로컬 모델 사용 (KURE-v1)
- 클라우드 서비스 최소화

### 단순함 우선
- 복잡한 아키텍처보다 동작하는 단순한 구조
- 필요할 때 확장, 미리 만들지 않음
- 개인 프로젝트이므로 빠른 개발 우선

## 시스템 구조

```
[뉴스 소스] → [Spring Boot API] → [PostgreSQL]
                                       ↓
                              [Python Analyzer] ← [Ollama]
```

### Spring Boot API (apps/api)
- 뉴스 크롤링 (KrxFileClient, NewsCrawlEngine 등)
- KRX 데이터 수집 (주가, 종목 마스터)
- REST API 제공

### Python Analyzer (apps/news-analyzer)
- LLM 기반 기업명 추출
- 벡터 임베딩 및 유사 뉴스 검색
- FastAPI로 API 제공

### 인프라
- Docker Compose로 로컬 배포
- PostgreSQL + pgvector

## 파이프라인 구조

```
[뉴스 원문]
     ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Stage 1: 종목 연결
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  재료 추출:
    - LLM 기업명 추출
    - 종목코드 패턴
    - 인물명 → 소속 회사
    - 제품/브랜드 → 제조사
    - 자회사/계열사 관계
    - 섹터/산업 키워드
    - URL/기사 메타데이터
  
  벡터 활용:
    - 과거 유사 뉴스 참조
    - 기업 프로필 매칭
    - 뉴스 클러스터링
     ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Stage 2: 뉴스 분류
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  실적, M&A, 신제품, 규제, 인사, 소송...
     ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Stage 3: 감성/영향
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  긍정 / 부정 / 중립
     ↓
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Stage 4: 요약
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  피드용 한줄 요약
     ↓
[가공 완료]
```

### Stage 1 상세: 종목 연결 재료

| 구분 | 방식 | 비고 |
|------|------|------|
| 직접 추출 | LLM 기업명 추출 | 핵심 |
| 직접 추출 | 종목코드 패턴 | 있으면 확실 |
| 연관 추론 | 인물명 → 소속 회사 | 마스터 데이터 필요 |
| 연관 추론 | 제품/브랜드 → 제조사 | 마스터 데이터 필요 |
| 연관 추론 | 자회사/계열사 관계 | 마스터 데이터 필요 |
| 간접 연결 | 섹터/산업 키워드 | 범위 넓음 |
| 메타데이터 | URL/기사 카테고리 | 출처 의존 |
| 벡터 | 과거 유사 뉴스 참조 | 데이터 쌓여야 효과 |
| 벡터 | 기업 프로필 매칭 | 프로필 구축 필요 |
| 벡터 | 뉴스 클러스터링 | 데이터 쌓여야 효과 |

### Stage 1 구현 순서

| 순서 | 항목 | 이유 |
|------|------|------|
| 1 | LLM 기업명 추출 | 마스터 데이터 없이 바로 시작 가능 |
| 2 | 종목코드 패턴 | 단순, 확실 |
| 3 | 벡터 (과거 뉴스) | 1번 결과 쌓이면 자연스럽게 가능 |

나머지는 마스터 데이터 구축되면 추가.

### 현재 구현 상태
- Stage 1 부분 구현: LLM 기업명 추출 (qwen2.5:7b)
- 임베딩: KURE-v1
- 유사 뉴스 검색: pgvector

### 벡터 활용 방안

**1. 종목 연결 전파**
```
[클러스터: 반도체 수출 규제 관련 뉴스 5건]
  - 뉴스A: 삼성전자 언급 ✅
  - 뉴스B: SK하이닉스 언급 ✅
  - 뉴스C: 기업명 없음 → 같은 클러스터니까 연결 가능
  - 뉴스D: "반도체 업계" 만 언급 → 연결 가능
  - 뉴스E: 기업명 없음 → 연결 가능
```

**2. 중복/유사 뉴스 처리**
```
같은 이슈 뉴스 10개
     ↓
피드에 다 보여줄 필요 없음
     ↓
대표 1개만 or "관련 뉴스 +9"
```

**3. 이슈 단위 파악**
```
개별 뉴스 → "삼성전자 뉴스 50건"
클러스터 → "삼성전자 관련 이슈 3건"
             - 실적 발표 (뉴스 20건)
             - 인사 이동 (뉴스 15건)
             - 신제품 (뉴스 15건)
```
피드에서 이슈 단위로 묶어서 보여줄 수 있음.

## 설계 결정 히스토리

### 2026-01-30: 로컬 LLM 선택
- **배경**: 뉴스에서 기업명 추출 필요
- **검토**: 키워드 매칭, NER 모델, 로컬 LLM
- **결정**: 로컬 LLM (qwen2.5:7b)
- **이유**: 약어(삼전), 띄어쓰기(삼성 전자) 등 문맥 이해 필요

### 2026-01-30: Python Analyzer 분리
- **배경**: Spring Boot에서 Ollama 연동이 복잡
- **결정**: Python FastAPI로 분석 서비스 분리
- **이유**: Python의 ML/NLP 생태계 활용, 역할 분리

### 2026-02-01: JPA Upsert 방식
- **배경**: 종목 마스터 데이터 daily upsert 필요
- **결정**: Native SQL 대신 saveAll() 사용
- **이유**: 소규모 데이터(~950건), 하루 1회, ORM 일관성 유지

---

## 향후 방향

### Stage 1 완성
- 종목 마스터 ↔ 추출 기업명 매칭 로직
- 종목코드 패턴 인식
- 인물/제품/브랜드 매핑 데이터

### Stage 2~4 설계
- 뉴스 분류 카테고리 정의
- 감성 분석 방식
- 요약 생성 프롬프트

---

*이 문서는 Architect가 지속적으로 업데이트합니다.*
